<nz-modal nzWidth="800px" [nzVisible]="true" [nzTitle]="isEdit ? 'Изменить подсервис' : 'Добавить подсервис'"
          (nzOnCancel)="closeModal()" (nzOnOk)="onSave()">
  <form nz-form [formGroup]="validateForm" [nzLayout]="'vertical'">
    <nz-form-label class="inline-labels" nzRequired>Выберите подсервисы</nz-form-label>

    <nz-select
      class="subservice-types"
      [nzMaxTagCount]="4"
      [nzMaxTagPlaceholder]="tagPlaceHolder"
      nzMode="multiple"
      nzPlaceHolder="Подсервисы"
      [(ngModel)]="listOfSelectedValue"
      (ngModelChange)="addOrDeleteItem($event)"
      [ngModelOptions]="{standalone: true}"
    >
      <nz-option *ngFor="let type of subserviceTypes" [nzLabel]="type.title[0].value" [nzValue]="type.subservice_type.id"></nz-option>
    </nz-select>
    <div formArrayName="items"
         class="item"
         *ngFor="let item of validateForm.get('items')['controls']; let i = index;">
      <div [formGroupName]="i">
        <h5>{{validateForm.get('items').controls[i].value.name}}</h5>
        <div nz-row [nzGutter]="24">
          <div nz-col [nzSpan]="8">
            <nz-form-label class="inline-labels" nzRequired>Цена</nz-form-label>
            <nz-form-item>
              <nz-form-control nzHasFeedback [nzErrorTip]="userErrorTpl">
                <input min="0" nz-input formControlName="price" type="number" placeholder="" />
              </nz-form-control>
            </nz-form-item>
          </div>
          <div nz-col [nzSpan]="8">
            <nz-form-label class="inline-labels" nzRequired>Единица измерения</nz-form-label>
            <nz-form-item>
              <nz-form-control nzHasFeedback [nzErrorTip]="userErrorTpl">
                <nz-select nzPlaceHolder="Единица измерения" formControlName="measurementType">
                  <nz-option *ngFor="let m of measurementTypes" [nzValue]="m.measurement_type.id"
                             [nzLabel]="m.title[0]?.value">
                  </nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </div>
          <div nz-col [nzSpan]="8">
            <nz-form-label class="inline-labels" nzRequired>Период гарантии (дней)</nz-form-label>
            <nz-form-item>
              <nz-form-control nzHasFeedback [nzErrorTip]="userErrorTpl">
                <input min="0" nz-input formControlName="guaranteeDays" type="number" placeholder="" />
              </nz-form-control>
            </nz-form-item>
          </div>
        </div>
      </div>
      <nz-divider></nz-divider>
    </div>
  </form>
</nz-modal>

<ng-template #userErrorTpl let-control>
  <ng-container *ngIf="control.hasError('required')">
    Это обязательное поле
  </ng-container>
  <ng-container *ngIf="control.hasError('min')">
    Значение должно быть положительным
  </ng-container>
</ng-template>
<ng-template #tagPlaceHolder let-selectedList> + {{ selectedList.length }}</ng-template>
